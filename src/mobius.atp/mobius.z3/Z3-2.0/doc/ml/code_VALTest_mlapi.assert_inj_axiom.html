<html><head>
<link rel="stylesheet" href="z3_ml.css" type="text/css">
<link rel="Start" href="index.html">
<link title="Index of types" rel=Appendix href="index_types.html">
<link title="Index of values" rel=Appendix href="index_values.html">
<link title="Index of modules" rel=Appendix href="index_modules.html">
<link title="Test_mlapi" rel="Chapter" href="Test_mlapi.html">
<link title="Z3" rel="Chapter" href="Z3.html"><title>Test_mlapi.assert_inj_axiom</title>
</head>
<body>
<code class="code"><span class="keyword">let</span>&nbsp;assert_inj_axiom&nbsp;ctx&nbsp;f&nbsp;i&nbsp;=&nbsp;<br>
&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;sz&nbsp;=&nbsp;<span class="constructor">Z3</span>.get_domain_size&nbsp;ctx&nbsp;f&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;i&nbsp;&gt;=&nbsp;sz&nbsp;<span class="keyword">then</span>&nbsp;exitf&nbsp;<span class="string">"failed&nbsp;to&nbsp;create&nbsp;inj&nbsp;axiom"</span>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;declare&nbsp;the&nbsp;i-th&nbsp;inverse&nbsp;of&nbsp;f:&nbsp;finv&nbsp;*)</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;finv_domain&nbsp;=&nbsp;<span class="constructor">Z3</span>.get_range&nbsp;ctx&nbsp;f&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;finv_range&nbsp;&nbsp;=&nbsp;<span class="constructor">Z3</span>.get_domain&nbsp;ctx&nbsp;f&nbsp;i&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;finv&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;<span class="constructor">Z3</span>.mk_fresh_func_decl&nbsp;ctx&nbsp;<span class="string">"inv"</span>&nbsp;[|finv_domain|]&nbsp;finv_range&nbsp;<span class="keyword">in</span><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;allocate&nbsp;temporary&nbsp;arrays&nbsp;*)</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;fill&nbsp;types,&nbsp;names&nbsp;and&nbsp;xs&nbsp;*)</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;types&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;<span class="constructor">Z3</span>.get_domains&nbsp;ctx&nbsp;f&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;names&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;<span class="constructor">Array</span>.init&nbsp;sz&nbsp;(<span class="constructor">Z3</span>.mk_int_symbol&nbsp;ctx)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;xs&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;<span class="constructor">Array</span>.init&nbsp;sz&nbsp;(<span class="keyword">fun</span>&nbsp;j<span class="keywordsign">-&gt;</span><span class="constructor">Z3</span>.mk_bound&nbsp;ctx&nbsp;j&nbsp;(types.(j)))&nbsp;<span class="keyword">in</span><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;create&nbsp;f(x_0,&nbsp;...,&nbsp;x_i,&nbsp;...,&nbsp;x_{n-1})&nbsp;*)</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;fxs&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;<span class="constructor">Z3</span>.mk_app&nbsp;ctx&nbsp;f&nbsp;xs&nbsp;<span class="keyword">in</span><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;create&nbsp;f_inv(f(x_0,&nbsp;...,&nbsp;x_i,&nbsp;...,&nbsp;x_{n-1}))&nbsp;*)</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;finv_fxs&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;mk_unary_app&nbsp;ctx&nbsp;finv&nbsp;fxs&nbsp;<span class="keyword">in</span><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;create&nbsp;finv(f(x_0,&nbsp;...,&nbsp;x_i,&nbsp;...,&nbsp;x_{n-1}))&nbsp;=&nbsp;x_i&nbsp;*)</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;eq&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;<span class="constructor">Z3</span>.mk_eq&nbsp;ctx&nbsp;finv_fxs&nbsp;(xs.(i))&nbsp;<span class="keyword">in</span><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;use&nbsp;f(x_0,&nbsp;...,&nbsp;x_i,&nbsp;...,&nbsp;x_{n-1})&nbsp;as&nbsp;the&nbsp;pattern&nbsp;for&nbsp;the&nbsp;quantifier&nbsp;*)</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;p&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;<span class="constructor">Z3</span>.mk_pattern&nbsp;ctx&nbsp;[|fxs|]&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;printf&nbsp;<span class="string">"pattern:&nbsp;%s\n"</span>&nbsp;(<span class="constructor">Z3</span>.pattern_to_string&nbsp;ctx&nbsp;p);<br>
&nbsp;&nbsp;&nbsp;&nbsp;printf&nbsp;<span class="string">"\n"</span>;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;create&nbsp;&amp;&nbsp;assert&nbsp;quantifier&nbsp;*)</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;q&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&nbsp;<span class="constructor">Z3</span>.mk_forall&nbsp;ctx&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;<span class="comment">(*&nbsp;using&nbsp;default&nbsp;weight&nbsp;*)</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[|p|]&nbsp;<span class="comment">(*&nbsp;the&nbsp;"&nbsp;of&nbsp;patterns&nbsp;*)</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;types<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;names<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eq<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;printf&nbsp;<span class="string">"assert&nbsp;axiom:\n%s\n"</span>&nbsp;(<span class="constructor">Z3</span>.ast_to_string&nbsp;ctx&nbsp;q);<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Z3</span>.assert_cnstr&nbsp;ctx&nbsp;q;<br>
&nbsp;&nbsp;<span class="keyword">end</span></code></body></html>