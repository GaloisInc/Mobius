%\newtheorem*{ex}{Lemma}

\section{Proofs from Section \ref{pogEq:aux}} \label{appendix:pogComp:pogEq:aux}


\begin{exprSrcBcWp1}[Wp of a compiled expression ] \label{exprValueOnStack}
 For any expression $\expressionSrc$ from our source language, for any formula $\psi$  
of the source assertion language and any formula $\phi$ such that $\phi$ may only 
contain stack expressions of the form     $\stack{\counter - k}, k \ge 0$ and if the modifies clauses of every
 method does not contain stack expression  the following holds:



  Forall formulas $ Q, R$  such that 
$$ \begin{array}{l}
      \wpSrcExpr{\expressionSrc }{ \psi }{ \excPost}{v} \  = \\ 
        \left( \begin{array}{l} Q \Rightarrow \psi   \end{array} \right) 
          \wedge  
	  R  \\
  \\
\Longrightarrow \\
 \\

  
	    \wpBcSeq{ \compileLabel{s}{\expressionSrc}{e} }{ \phi }{\excPost} \  = \\ 
             \left( \begin{array}{l} Q \Rightarrow \left( \begin{array}{l} \phi \begin{array}{l}
                                       \subst{\counter}{\counter + 1}\\
			               \subst{\stack{\counter +1}}{ v }
                         \end{array} \end{array} \right) \end{array} \right)
          \wedge 
	  R 
  \end{array}$$
and 
forall formulas $ Q, R$  such that 
$$ \begin{array}{l} \wpSrcExpr{\expressionSrc }{ \psi }{ \excPost}{v} \  = \\
      \forall \freshVar, %\freshVar_1, \ldots  \freshVar_k   , 
             \left( \begin{array}{l} Q \Rightarrow \left( \begin{array}{l} \psi \subst{v}{ \freshVar}\end{array} \right)  \end{array} \right) 
                                                                             %    \begin{array}{l}
									     %       \\
									     %  \subst{v_1 }{ \freshVar_1 }  \\
									     %	\ldots \\
									     %	\subst{v_k}{ \freshVar_k } 
									     %   \end{array}  
                                                                  \wedge   R     

 \\
\Longrightarrow \\
 \\

\wpBcSeq{ \compileLabel{s}{\expressionSrc}{e} }{ \phi }{\excPost} \  = \\ 
            \forall \freshVar, % \freshVar_1, \ldots  \freshVar_k ,  
                              \left( \begin{array}{l} Q \Rightarrow  \left( \begin{array}{l} \phi  \begin{array}{l}\subst{\counter}{\counter + 1} \\
                                                                                                  \subst{\stack{\counter +1}}{\freshVar  } \end{array} \end{array} \right)
			       \end{array} \right)      
			               
                                    %  \begin{array}{l}
				    %   \subst{v_1 }{ \freshVar_1 }  \\
				    %   \ldots \\
				    %   \subst{v_k}{ \freshVar_k } 
				    % \end{array}  
				    \wedge R
	
\end{array}$$
\end{exprSrcBcWp1} 




We  show several cases of the proof for the first part of the lemma,  which is done by induction over the expression structure.
The second case of the lemma refers to instance creation expressions and method invokation. The rest of the cases
proceed in  a similar way. 

Proof : \\
 


\begin{enumerate} 
		\item    $\expressionSrc = const , const \in \ \constantInt, \Mytrue, \Myfalse $
                     
		     $$ \begin{array}{l}  
		               \mbox{\rm\comment{source case }} \\
		              \numConclusion{1} \wpSrcExpr{ const}{\psi}{ \excPost}{const}  \\
		    	       \mbox{\rm\comment{following the definition of the wp function for source expressions in subsection  \ref{pog:wpSrc:wpExpr} }} \\
			       = \psi \\
			       \\
			       \mbox{\rm\comment{bytecode case }} \\
		               \numConclusion{2} \wpBcSeq{\compileLabel{s}{const}{s} }{\phi}{ \excPost}  \\
			
		    	       \mbox{\rm\comment{following the definition   of the compiler function in subsection \ref{pogEq:compile:compExpr} }} \\
			       = \wpExpl{s \ \push const }{\phi}{ \compile{\excPost}}  \\
			       \mbox{\rm\comment{following the definition of the wp function for bytecode in subsection \ref{pog:wpSrc:wpExpr}  }} \\
			       = \phi \begin{array}{l}
                                                \subst{ \counter }{ \counter + 1}\\
						\subst{\stack{ \counter +1} }{const  }
					    \end{array} \\
			        \\
				\\
				 \mbox{\rm\comment{from \numConclusion{1} and   \numConclusion{2} and $Q,R = \true $ this case holds   }} \\
					 
				    
			\end{array}$$
                        
			
			
                \item  $\expressionSrc = \expressionSrc.f $
                         $$ \begin{array}{l}  
		               \mbox{\rm\comment{source case }} \\
		               \numConclusion{1} \ \wpSrcExpr{ \expressionSrc.f  }{\psi}{ \excPost}{v.f}  \\
		    	       \mbox{\rm\textit{\{following the definition of the wp function  }} \\
			        \mbox{\rm\textit{ for source expressions in subsection  \ref{pog:wpSrc:wpExpr}  \} }} \\
			       = \wpSrcExpr{\expressionSrc }{ \begin{array}{l}
                                                                 v \neq \Mynull \Rightarrow \psi\\
								 \wedge \\
								 v = \Mynull \Rightarrow\methodd.\excPost(\NullPointerExc)
								 \end{array} }{ \excPost  }{v}  \\
			       \\
			       \\ 
			        \mbox{\rm\comment{bytecode case }} \\
		               \numConclusion{2} \  \wpBcSeq{ \compileLabel{s}{\expressionSrc.f}{e}}{\phi}{\compile{ \excPost}}   \\
			       \mbox{\rm\comment{following the definition of the compiler function in subsection \ref{pogEq:compile:compExpr} }} \\
			       = \wpBcSeq{ \begin{array}{l}
			                          \compileLabel{s}{\expressionSrc}{e-1} \\
						   e \ \getfield  \ f
						 \end{array} }{\phi}{ \excPost}  \\
			       \mbox{\rm\textit{\{following the definition of the wp function for bytecode    }} \\
			        \mbox{\rm\textit{ in subsection \ref{pog:wpBcGeneral}  \} }} \\
			        = \wpBcSeq{ \compileLabel{s}{\expressionSrc}{e-1}}{\\
                                                                          \phantom{wp^{bc}} \begin{array}{l} 
				                                                 \stack{\counter} \neq \Mynull \Rightarrow  \\
										    \phi \subst{\stack{ \counter} }{ \fieldAccess {\stack{\counter}}{\fieldd} } \\
										    \wedge \\
										    \stack{\counter} = \Mynull   \Rightarrow  \methodd.\excPost (\NullPointerExc)  
										 
				                                            \end{array} }{\\ \phantom{wp^{bc}} \compile{ \excPost}} \\
				\end{array}$$

			 $$ \begin{array}{l} 

	\mbox{\rm\comment{From \numConclusion{1} and \numConclusion{2} we apply the induction hypothesis  }} \\		
				\exists Q', R' : \formulaSrc , \\ 
			       \numConclusion{3} \
						\wpSrcExpr{\expressionSrc }{ \begin{array}{l}
                                                                 v \neq \Mynull \Rightarrow \psi\\
								 \wedge \\
								  v = \Mynull \Rightarrow\methodd.\excPost(\NullPointerExc)
								 \end{array} }{ \excPost  }{v}  \\
				=  \\
				Q'  \Rightarrow \begin{array}{l}
				                     v \neq \Mynull \Rightarrow \psi\\
						     \wedge \\
						     v \neq \Mynull \Rightarrow\methodd.\excPost(\NullPointerExc)
				               \end{array} \\
					      \wedge \\
					       R' \\\\
			  \Longrightarrow \\	   
			        \wpBcSeq{ \compile{\expressionSrc}}{\\
                                                                          \phantom{wp^{bc}} \begin{array}{l} 
				                                                 \stack{\counter} \neq \Mynull \Rightarrow  \\
										    \phi \subst{\stack{ \counter} }{ \fieldAccess {\stack{\counter}}{\fieldd} }\\
										    \wedge \\
										    \stack{\counter} = \Mynull   \Rightarrow  \methodd.\excPost (\NullPointerExc)  
										 
				                                            \end{array} }{\\ \phantom{wp^{bc}} \compile{ \excPost}} \\
				= \\

\end{array}$$
$$\begin{array}{l}

				Q'  \Rightarrow \begin{array}{ll}
				                                \begin{array}{l} \stack{\counter} \neq \Mynull \Rightarrow \phi\subst{\stack{ \counter}}{\fieldAccess {\stack{\counter}}{\fieldd}}\\
								\wedge \\
								\stack{\counter} = \Mynull \Rightarrow\methodd.\excPost(\NullPointerExc) 
							  \end{array} &
							  \begin{array}{l}   
						                \subst{\counter}{\counter + 1} \\
								 \subst{\stack{\counter + 1}}{v }
						          \end{array}
				               \end{array} \\	
			        \wedge \\
			       R'
			       \\
			       	=  \\
			
				 \mbox{\rm\comment{$\phi$ contains only stack expressions $\stack{\counter - k } , k \ge 0$ and properties of substitution }} \\
 				 Q'  \Rightarrow \begin{array}{l}
				                                 v \neq \Mynull \Rightarrow \phi
                                                                 \begin{array}{l}
								   \subst{\counter}{\counter + 1} \\
								   \subst{\stack{\counter + 1}}{\fieldAccess{v}{\fieldd} }
								   \end{array}  \\
								\wedge \\
								v = \Mynull \Rightarrow\methodd.\excPost(\NullPointerExc) 
							  
							  
				               \end{array} \\	
			        \wedge \\
			       R'		\\
			       \\
			       \mbox{\rm\comment{from \numConclusion{3}  this case holds  }}\\
			       		 
		      	\end{array}$$

\end{enumerate}

\Qed\\

	
						
         
