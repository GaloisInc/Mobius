\subsubsection{Expressions}\label{pog:wpSrc:wpExpr}
The weakest precondition function for expressions has the following signature:
$$ \wpNameSrcExpr : \expressionSrc \rightarrow \formulaSrc \rightarrow ( \mbox{ \rm \texttt{Exc}} \rightarrow  \formulaSrc ) \rightarrow  
\MethodSet \rightarrow   \expressionSpecSrc \rightarrow  \formulaSrc $$

For calculating the  $\wpNameSrcExpr$  \ predicate  of  an expression $\expressionSrc$ declared in method \methodd,
 the function $\wpNameSrcExpr$ \ takes as arguments  $\expressionSrc$, a postcondition $\normalPostSrc$, an exceptional postcondition 
function $\excPostSrc$  and  an $\expressionSpecSrc$ and returns the    formula 
$\wpSrcExpr{\expressionSrc}{\psi}{\excPostSrc}{ \expressionSpecSrc}$ which is the \wpName \ precondition of $\expressionSrc$ 
if the its value is represented by $\expressionSpecSrc$.

In the following, we give the rules of $\wpNameSrcExpr$.
\begin{itemize}

      \item integer and boolean constant access \\
	  ( $const \in \{  \constantInt , \Mytrue , \Myfalse, \constantRef  \}$ )
	$$ \wpSrcExpr{const}{\normalPostSrc }{ \excPostSrc }{const} = \normalPostSrc $$
	
    \item field access expression
	         $$ \begin{array}{l} 
             \wpSrcExpr{\expressionSrc_1.f  }{\normalPostSrc }{ \excPostSrc }{v.f} = \\
	                        \wpSrcExpr{\expressionSrc_1 }{\\
			                   \phantom{wpiSr} \begin{array}{l} 
						        v \neq \Mynull \Rightarrow \normalPostSrc\\
			                                \wedge \\
						        v = \Mynull \Rightarrow \excPostSrc(\texttt{ NullPointerExc} ,\expressionSrc_1 ) 
		                                   \end{array}}{\\ \phantom{wpiSrc} \excPostSrc }{v} 
                     		  
                  
	    \end{array} $$

	 \item arithmetic expressions 
             $$ \begin{array}{l}
	              \wpSrcExpr{ \expressionSrc_1 \ op \ \expressionSrc_2 }{\normalPostSrc }{ \excPostSrc }{v_1 + v_2} =  \\
		      \wpSrcExpr{ \expressionSrc_1  }{\wpSrcExpr{\expressionSrc_2 }{ \normalPostSrc }{ \excPostSrc }{v_2}  }{ \excPostSrc }{v_1}
		\end{array}$$

	\item method invokation

  $$ \begin{array}{l} \wpSrcExpr{ \expressionSrc.m()  }{\normalPostSrc }{ \excPostSrc }{v} = \\
	     \wpSrcExpr{\expressionSrc}{ \\
                          
                            \phantom{ wpisrc \expressionSrc_1 }  
			     \left\{ \begin{array}{l}
			      v'  \neq \mbox{ \rm \Mynull }  \Rightarrow     \\
			      
                                         \Myspace    \Myspace    m.\preSrc  %\begin{array}{l} 
					                         \subst{\this}{ v'} \\
                                                                 %\subst{\mbox{\rm arg}}{ v_2} \\
					                  %\end{array}  \\
                                          \Myspace   \Myspace \wedge \\
					  \Myspace   \Myspace \forall \freshVar, \ \forall \ m \in m. \mod \\ 
					  
                                          \Myspace   \Myspace  \left\{\begin{array}{l}  
					  \typeof{\freshVar} <: m.\returnType \wedge \\ 
					  m.\normalPostSrc
					                                \begin{array}{l} 
					                                    \subst{\result}{\freshVar } \\
									    \subst{ \this}{ v' } \\
									   % \subst{\mbox{\rm arg} }{ \expressionSrc_2}
					                                 \end{array}   \\
                                             \Myspace \Rightarrow \normalPostSrc  \subst{ v }{ \freshVar }  \\ 
					                       \end{array}\right.\\
					     \Myspace   \Myspace \wedge \\
					     \Myspace   \Myspace	 \forall \mbox{\rm \texttt{E}} \in m.\exceptionSrc, \\
					     \Myspace   \Myspace	 \forall \ m \in m. \mod\\
					     \Myspace   \Myspace  
					  \begin{array}{l}
					         m.\excPostSpecSrc( \mbox{\rm \texttt{E}} ) \Rightarrow \excPostSrc( \mbox{\rm \texttt{E}} )
					  \end{array} \\ 
			                \expressionSrc_1 = \mbox{ \rm \Mynull }  \Rightarrow    \excPostSrc( \NullPointerExc )
                           \end{array}\right. 
       } { \\  \phantom{ wpisrc \expressionSrc_1 } \excPostSrc  } 
	       {v'  }
 
            \end{array} $$	 



	  \item Cast expression \todo{may be give an example}
	       $$ \begin{array}{l} \wpSrcExpr{ ( \class ) \ \expressionSrc  }{\normalPostSrc }{ \excPostSrc }{v} = \\
	           \wpSrcExpr{ \expressionSrc } { \\ 
                      
                    \phantom{wpSr} \begin{array}{l}
                    \typeof{v } <:\class  \Rightarrow    \\
		      \phantom{wpSr} \phantom{wpSr}   \normalPostSrc  \\
		     \wedge \\
		    \neg \   \typeof{v } <:  \class \Rightarrow  \\ 
                     \phantom{wpSr} \phantom{wpSr}  \excPostSrc( \mbox{ \rm \ClassCastExc }  )
                    \end{array}  } { \\ \phantom{wpSrc}  \excPostSrc }{v}
	            \end{array} 
	          $$
				
                               
	   
            
	    \item Null expression

		    $$ \wpSrcExpr{\Mynull  }{\normalPostSrc }{ \excPostSrc }{\Mynull} = \normalPostSrc $$
           
	    \item this 

		    $$ \wpSrcExpr{\this  }{\normalPostSrc }{ \excPostSrc }{\this} = \normalPostSrc $$
           	       
	 \item instance creation

%\todo{may the precondition of a class constructor talk about this? I would say no } 

  $$ \begin{array}{l} 
    \wpSrcExpr{ \newSrc \ \class  ( \expressionSrc  ) } {\normalPostSrc }{ \excPostSrc  }{v} = \\
 	  
 	             \wpSrcExpr{\expressionSrc} { \\ \\
 		                \phantom{wpSr}\left\{ \begin{array}{l}
                                    \forall \freshVar, \\
 				   \Myspace  not \ \instances(\freshVar ) \wedge \\
 					       \Myspace  \freshVar  \neq \Mynull \Rightarrow \\ 
 				   \Myspace  \Myspace  \Constructor{\class}.\preSrc
 				                \begin{array}{l} 
                                                       \subst{ \this}{ \Ref{Class} } \\
                                                       \subst{ arg}{ v' } \\
  					     	\end{array} \\
  					\Myspace  \Myspace	       \wedge \\
  					\Myspace  \Myspace  \forall \ m \in \Constructor{Class}. \mod , \\
  					       \Myspace  \Myspace  \Myspace    \Constructor{Class}.\normalPostSrc       
  					             \begin{array}{l}   
  						          \subst{ \this}{ \freshVar  } \\
  						          \subst{ arg}{ v' } \\
  						       	  \subst{	\typeof{\freshVar}}{ Class} 
  						     \end{array}  \\
                                                   \Myspace  \Myspace   \Myspace      \Rightarrow   \normalPostSrc \subst{ v }{ \freshVar  } \\ 
  					          \Myspace  \Myspace \wedge \\
  						   \Myspace  \Myspace  \forall \mbox{\rm \texttt{Exc}} \in  \Constructor{Class}.\exceptionSrc, \\
  						    \Myspace \Myspace  \forall \ m \in \Constructor{Class}. \mod, \\
  						 \Myspace  \Myspace  \Myspace \Constructor{Class}.\excPostSpecSrc ( \mbox{\rm\texttt{Exc}}) \Rightarrow \excPostSrc( \mbox{\rm\texttt{Exc}})
  		              \end{array}\right. } {  \\  \\ \phantom{wpSrc}   \excPostSrc }{v'}  
  		     
              \end{array}  $$ 
  
  \end{itemize}


Let us see the relational expressions supported in the source programming language

\begin{itemize} 
     \item Instanceof expression
	        $$ \begin{array}{l} \wpSrcExpr{ \expressionSrc \ instanceof \ \class }{\normalPostSrc }{ \excPostSrc }{ \typeof{ v } <:  \class \wedge v \neq \Mynull} = \\
	                \wpSrcExpr{ \expressionSrc  }{ \normalPostSrc }{ \excPostSrc }{v}
	            \end{array} $$

     \item Binary relation over expressions
            $$ \begin{array}{l} \wpSrcExpr{ \expressionSrc_1 \ \rel \ \expressionSrc_2 }{\normalPostSrc }{ \excPostSrc }{v_1 \rel v_2} = \\
	                \wpSrcExpr{ \expressionSrc_1  }{  \wpSrcExpr{ \expressionSrc_2  }{ \normalPostSrc }{ \excPostSrc }{v_2}  }{ \excPostSrc }{v_1}
	            \end{array} $$
\end{itemize}
