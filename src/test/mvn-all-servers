#/bin/bash
#
# Distribution script for remote testing with Maven
# This script sits on a Continuum server and runs in place of the 'mvn' command
# e.g. ln -sf <this-script> /opt/local/bin/mvn
# see https://mobius.ucd.ie/wiki/ParallelTesting
#
#
# 1. Update local test scripts and authprogs.conf
#
ssh maven@arrow.ucd.ie ./test/self_update.sh $*
ssh maven@object.ucd.ie ./test/self_update.sh $*
ssh maven@athena.insttech.washington.edu ./test/self_update.sh $*
ssh maven@boomer.insttech.washington.edu ./test/self_update.sh $*
#
# 2. Run the Maven test suites
#
ssh maven@arrow.ucd.ie ./test/run_test.sh $*
ssh maven@object.ucd.ie ./test/run_test.sh $*
ssh maven@athena.insttech.washington.edu ./test/run_test.sh $*
ssh maven@boomer.insttech.washington.edu ./test/run_test.sh $*
#
# 3. Collect the test reports for viewing by Continuum
#
rsync maven@arrow.ucd.ie:ESCTools/target/surefire-reports/TEST-DistributedTest.xml ./target/surefire-reports/TEST-arrow.ucd.ie.xml
rsync maven@object.ucd.ie:ESCTools/target/surefire-reports/TEST-DistributedTest.xml ./target/surefire-reports/TEST-object.ucd.ie.xml
rsync maven@athena.insttech.washington.edu:ESCTools/target/surefire-reports/TEST-DistributedTest.xml ./target/surefire-reports/TEST-athena.insttech.washington.edu.xml
rsync maven@boomer.insttech.washington.edu:ESCTools/target/surefire-reports/TEST-DistributedTest.xml ./target/surefire-reports/TEST-boomer.insttech.washington.edu.xml
